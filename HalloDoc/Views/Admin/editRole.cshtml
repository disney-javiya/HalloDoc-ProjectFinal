@model HalloDoc.DataAccessLayer.DataModels.Role;

@{
    Layout = "_AdminHeader";
}

        <main>


            <div class="main-create-patient-req d-flex justify-content-center align-items-center mt-1">
                <div class="row row-cols-1 justify-content-center align-items-center width-create-patient-req ">

                    <div class="d-flex flex-row">
                        <h3>Edit Role</h3>

                    </div>
                    <div class="d-flex">

                        <a role="button" style="height:fit-content;" asp-controller="Admin" asp-action="adminAccess" class="back-btn p-1 ms-auto mb-2">Back</a>
                    </div>
                    <form method="post" class="row row-cols-1 " action="@Url.Action("editRole", "Admin",new { roleId =  Context.Request.Query["roleId"]})" enctype="multipart/form-data">
                        <div class="col-md-6 gy-3">
                            <div class="form-floating mb-3">
                                <input asp-for="Name" type="text" class="form-control rname first-name-create-patient shadow-none e1" id="floatingInput"  placeholder="">
                                <label class="first-name-create-patient-text" for="floatingInput">Role Name</label>

                            </div>
                        </div>

                        <div class="col-md-6 gy-3">
                            <select asp-for="AccountType" class="form-select mb-3 p-3 ainfo" aria-label="Default select example" id="accountType">
                                <option selected>Account Type</option>
                                <option value="1">Admin</option>
                                <option value="2">Physician</option>
                                <option value="3">All</option>
                            </select>

                        </div>

                  
                        <div id="checkbox-container" class="col-md-6 gy-3">
                            <input type="hidden" id="uncheckedCheckboxesInput" name="uncheckedCheckboxes" />

                        </div>


                        <div class="col d-flex justify-content-end mb-2">
                            <button type="submit" role="button" class="btn save-btn-patient-profile  me-2 p-2" id="submitbtn">Save</button>

                            <a role="button" class="btn cancel-btn-patient-profile  me-2 p-2" id="cancel1">Cancel</a>
                        </div>



                     </form> 
                </div>
            </div>

        </main>


     <script>
        $(document).ready(function () {

                var accountType = $('#accountType').val();
          
                $.ajax({
                    url: '/Admin/menuByAccountType',
                    method: 'GET',
                    data: { 'accountType': accountType },
                    success: function (data) {
                        $('#checkbox-container').empty();
                        $.each(data, function (index, menu) {

                            var checkbox = $('<input>').attr({
                                type: 'checkbox',
                                name: 'menu',

                                value: menu.menuId
                            });

                            var label = $('<label>').text(menu.name);

                            var container = $('#checkbox-container');
                            container.append(checkbox).append(" ").append(label).append('<br>');

                           
                        });

                    },
                    error: function (xhr, status, error) {
                        console.error("Error fetching regions:", xhr.status, xhr.statusText);
                        console.error("Response body:", xhr.responseText);
                        alert("Failed to fetch pages. Please try again later.");
                    }



                });
           
        });
    </script>
 
 
    <script>
        $(document).ready(function () {
            var accountType = $('#accountType').val();
            // var roleId = $('.rname').val();
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const roleId = urlParams.get('roleId');
           
            $.ajax({
                url: '/Admin/menuByAccountType',
                method: 'GET',
                data: { 'accountType': accountType },
                success: function (data) {
                    $('#checkbox-container').empty();
                    $.each(data, function (index, menu) {
                        var checkbox = $('<input>').attr({
                            type: 'checkbox',
                            name: 'menu',
                            value: menu.menuId
                        });

                        var label = $('<label>').text(menu.name);

                        var container = $('#checkbox-container');
                        container.append(checkbox).append(" ").append(label).append('<br>');
                    });

                   
                    $.ajax({
                        url: '/Admin/menuByAccountTypeRoleId',
                        method: 'GET',
                        data: { 'accountType': accountType , 'roleId': roleId },
                        success: function (secondData) {
                          
                            $('input[name="menu"]').each(function () {
                                var menuId = $(this).val();
                               
                              
                                if (secondData.some(menu => menu == menuId)) {
                                    $(this).prop('checked', true);
                                }
                            });
                        },
                        error: function (xhr, status, error) {
                            console.error("Error fetching menus by criteria:", xhr.status, xhr.statusText);
                            console.error("Response body:", xhr.responseText);
                            alert("Failed to fetch menus by criteria. Please try again later.");
                        }
                    });
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching menus by account type:", xhr.status, xhr.statusText);
                    console.error("Response body:", xhr.responseText);
                    alert("Failed to fetch menus. Please try again later.");
                }
            });
        });

    </script>
