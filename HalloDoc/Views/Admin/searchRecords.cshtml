@model HalloDoc.DataAccessLayer.DataModels.ViewModels.dashboardTableModel


@{
    Layout = "_AdminHeader";
}
<script>
    function changePage(page) {


        $.ajax({
            url: "/Admin/searchRecords",
            method: "GET",
            data: { 'pagenumber': page },

            success: function (data) {

            },
            error: function () {

            }
        });
    }
</script>
        <main>

            <div class="main-viewdocuments d-flex flex-column">
                <div class="view-documents d-flex flex-column ">
                    <div class="d-flex flex-row">
                        <h3>Search Records</h3>
                     
                    </div>
                     <form  action="/Admin/searchRecords" method="POST"> 
                    <div class="row d-flex justify-content-between">
                        <div class="col-md-3 gy-3">
                            <div class=" mb-3">
                                <select name="requestStatus" id="requestStatus" class="form-select p-2">
                                  <option selected>Select Request Status</option>
                                    <option value="1">Unassigned</option>
                                    <option value="2">Accepted</option>
                                    <option value="3">Cancelled</option>
                                    <option value="4">MDEnRoute	</option>
                                    <option value="5">MDONSite</option>
                                    <option value="6">Conclude</option>
                                    <option value="7">CancelledByPatient</option>
                                    <option value="8">Closed</option>
                                    <option value="9">Unpaid</option>
                                    <option value="10">Clear</option>
                              </select>

                            </div>
                        </div>
                        <div class="col-md-3 gy-3">
                            <div class="form-floating mb-3">
                                <input name="patientName" id="patientName" type="text" class="form-control first-name-create-patient shadow-none" placeholder="">
                                <label class="first-name-create-patient-text" for="floatingInput">Patient Name</label>

                            </div>
                        </div>
                        <div class="col-md-3 gy-3">
                            <div class=" mb-3">
                                <select name="requestType" id="requestType" class="form-select ">
                                    <option selected>Select Request Type</option>
                                    <option value="1">Business</option>
                                    <option value="2">Patient</option>
                                    <option value="3">Family</option>
                                    <option value="4">Concierge</option>
                                </select>

                            </div>
                        </div>
                        <div class="col-md-3 gy-3">
                            <div class="form-floating mb-3">
                                <input name="fromDate" id="fromDate" type="date" class="form-control dob-create-patient shadow-none" placeholder="">
                                <label class="dob-create-patient-text" for="floatingInput">From Date Of Service</label>

                            </div>
                        </div>
                        <div class="col-md-3 gy-3">
                            <div class="form-floating mb-3">
                                <input name="toDate" type="date" class="form-control dob-create-patient shadow-none" id="toDate" placeholder="">
                                <label class="dob-create-patient-text" for="floatingInput">To Date Of Service</label>

                            </div>
                        </div>
                        <div class="col-md-3 gy-3">
                            <div class="form-floating mb-3">
                                <input name="providerName" type="text" class="form-control first-name-create-patient shadow-none" id="providerName" placeholder="">
                                <label class="first-name-create-patient-text" for="floatingInput">Provider Name</label>

                            </div>
                        </div>
                        <div class="col-md-3 gy-3">
                            <div class="form-floating mb-3">
                                <input name="email" type="email" id="email" class="form-control email-create-patient shadow-none" mailto:placeholder="name@example.com">
                                <label class="email-create-patient-text">Email</label>
                            </div>
                        </div>
                        <div class="col-md-3 gy-3 ">
                            <div class="form-floating mb-3">
                                <input name="phone" class=" form-control contact-create-patient shadow-none info" id="phone" type="tel" />
                                <label class="contact-create-patient-text" for="phone"> </label>
                            </div>
                        </div>

                    </div>
                  
                    <div class="d-flex justify-content-end m-2">
                    <a role="button" href="@Url.Action("clearBtnSearch", "Admin", new { id = "clearBtnSearchRecords"})" class="btn back-btn me-2">Clear</a>
                        <button role="button" id="searchbtn" type="submit" class="btn submit-btn-create-patient">Search</button>
                    </div>
                    </form> 


                    <div class="data-table-admin-viewuploads" id="searchTable">
                        <table class="table">
                            <thead>
                                <tr>

                                    <th scope="col">Patient Name</th>
                                    <th scope="col">Requestor</th>
                                    <th scope="col">Date Of Service</th>
                                    <th scope="col">Close Case Date</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Phone Number</th>
                                    <th scope="col">Address</th>
                                    <th scope="col">Zip</th>
                                    <th scope="col">Request Status</th>
                                    <th scope="col">Physician</th>
                                    <th scope="col">Physician Note</th>
                                    <th scope="col">Cancelled By Provider Note</th>
                                    <th scope="col">Admin Note</th>
                                    <th scope="col">Patient Note</th>
                                    <th scope="col">Delete Permanently</th>                            
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null)
                                {
                                    @foreach (var item in Model.records)
                                    {
                                        <tr>


                                             <td>
                                                @Html.DisplayFor(modelItem => item.patientName)

                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.requestorName)

                                            </td>
                                            <td>
                                                
                                                
                                                    @Html.DisplayFor(modelItem => item.FromDateOfService)
                                                

                                            </td>
                                            <td>
                                                @if (item.Status == 3 || item.Status == 7 || item.Status == 8)
                                                {
                                                    @Html.DisplayFor(modelItem => item.ToDateOfService)

                                                }


                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem =>   item.patientEmail )

                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem =>   item.patientContact )

                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem =>   item.patientAddress )

                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem =>   item.patientZipCode )

                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem =>   item.Status )

                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem =>   item.physicianName )

                                            </td>
                                            <td>
                                                    @Html.DisplayFor(modelItem =>   item.physicianNote)

                                            </td>
                                            <td>
                                                    @Html.DisplayFor(modelItem =>   item.cancelByProviderNote)
                                            </td>
                                             <td>
                                                    @Html.DisplayFor(modelItem =>   item.adminNote)
                                            </td>
                                   
                                             <td>
                                                    @Html.DisplayFor(modelItem =>   item.patientNote)
                                            </td>
                                            <td>
                                        <a class="providermenu-btn p-1" role="button" id="delete-option" value="@item.requestId" data-bs-toggle="modal" data-bs-target="#myModal">Delete</a>
                                            </td>
                                             
                                               
                                        </tr>
                                    }
                                }


                            </tbody>
                        </table>
                    </div>




                </div>
            </div>
        </main>



    <script>
        const phoneInputField = document.querySelector("#phone");
        const phoneInput = window.intlTelInput(phoneInputField, {
            utilsScript:
                "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });

    </script>

<!--For Delete-->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="deleteConfirmationForm" asp-controller="Admin" asp-action="deleteRequest" method="POST">

                <!-- Modal Header -->
                <div class="modal-header" style="background:#01bce9; color:white;">
                    <h4 class="modal-title">Delete Confirmation</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div class="modal-body" style="color:grey;">


                    <input type="hidden" id="requestinput" name="requestId" />
                    <b> ARe you sure you want to delete this role type?</b>

                </div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="submit" class="btn submit-btn-cancelcase">Confirm</button>
                    <button type="button" class="btn cancel-btn-cancelcase" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
    var requestId;
    $(document).on('click', '#delete-option', function () {

        requestId = $(this).attr("value");

    });

    $('#deleteConfirmationForm').submit(function (event) {

        $('#requestinput').val(requestId);


    });
</script>




<div aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-3">
        @if (Model.TotalPages >= 1)
        {
            <!-- Previous page -->
            <li class="page-item @(Model.PreviousPage ? " " : "disabled")">
                <a class="page-link" href="javascript:void(0)" onclick="changePage(@Model.CurrentPage-1)" aria-label="Previous">
                    <span aria-hidden="true"><i class="bi bi-caret-left-fill text-info"></i> </span>
                </a>
            </li>

            <!-- Page numbers -->
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(Model.CurrentPage == i ? "active" : " ")">
                    <a class="page-link" id="plink-@i" href="javascript:void(0)" onclick="changePage(@i)">@i</a>
                </li>
            }

            <!-- Next page -->
            <li class="page-item @(Model.NextPage ? " " : "disabled")">
                <a class="page-link" href="javascript:void(0)" onclick="changePage(@Model.CurrentPage+1)" aria-label="Next">
                    <span aria-hidden="true"> <i class="bi bi-caret-right-fill text-info"></i> </span>
                </a>
            </li>
        }
    </ul>
</div> 

